# Kent - Безопасность

## E2EE (End-to-End Encryption)

### Signal Protocol

Kent использует модифицированный Signal Protocol для E2EE:

1. **X3DH (Extended Triple Diffie-Hellman)**
   - Установка сессии между устройствами
   - Prekey bundles хранятся на сервере (публичные ключи)
   - Identity keys проверяются через Safety Numbers

2. **Double Ratchet**
   - Постоянное обновление ключей
   - Forward secrecy
   - Post-compromise security

3. **Sender Keys (для групп)**
   - Эффективное шифрование для групповых чатов
   - Один ключ на отправителя в группе

### Хранение ключей

- **Android Keystore** — защищенное хранилище
- **Опциональная биометрия** — Face ID / Fingerprint
- **Ключи НЕ хранятся на сервере** — только публичные prekey bundles

---

## Сетевая безопасность

### TLS 1.3

- Все соединения используют TLS 1.3
- Минимальная версия TLS: 1.2

### Certificate Pinning

- Публичные ключи сертификатов закреплены в приложении
- Защита от MITM-атак
- Обновление через remote config

### mTLS (внутри кластера)

- Микросервисы аутентифицируются через mTLS
- Сертификаты ротируются автоматически

---

## Защита звонков (WebRTC)

### SRTP/DTLS

- Медиа шифруются через SRTP
- Сигнализация через DTLS
- TURN-серверы с аутентификацией

---

## Антиспам и антифрод

### Rate Limiting

- **API Gateway** — глобальные лимиты
- **Per-user лимиты** — на уровне сервисов
- **Per-IP лимиты** — для auth endpoints

### AI-Guardian

- **Поведенческий анализ** — детект подозрительных паттернов
- **Фишинг-детект** — анализ ссылок
- **Токсичность** — анализ текста
- **Локальная фильтрация** — режим "конфиденциальность+"

---

## Play Integrity API

- Проверка целостности устройства
- Защита от модификаций (root, эмуляторы)
- Интеграция на критических endpoints

---

## Соответствие требованиям

### GDPR

- Право на удаление данных
- Экспорт данных
- Согласие на обработку
- Data Residency (EU)

### CCPA

- Право на удаление
- Право на отказ от продажи данных
- Прозрачность

---

## Аудит безопасности

### Чек-лист

- [ ] E2EE для всех сообщений
- [ ] TLS 1.3 для всех соединений
- [ ] Certificate pinning
- [ ] Rate limiting
- [ ] Play Integrity API
- [ ] Шифрование в покое
- [ ] Минимизация данных
- [ ] Регулярные обновления зависимостей
- [ ] Security headers (CSP, HSTS)
- [ ] Логирование безопасности (без чувствительных данных)

