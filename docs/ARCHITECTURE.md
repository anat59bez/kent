# Kent Messenger - Архитектура

## Brand Palette: Azure

**Primary:** #2563EB | **Secondary:** #06B6D4 | **Tertiary:** #A78BFA  
**Background L/D:** #F8FAFC / #0B1220

---

## 1. Анализ референсов

### Сравнительная таблица

| Функция | MAX | WhatsApp | Telegram | TikTok | X (Twitter) | Kent (наш подход) |
|---------|-----|----------|----------|--------|-------------|-------------------|
| **E2EE** | ✅ Signal-подобный | ✅ Signal Protocol | ❌ Опционально | ❌ | ❌ | ✅ Signal Protocol + улучшения |
| **Масштабируемость** | Средняя | Высокая | Очень высокая | Очень высокая | Очень высокая | Микросервисы, горизонтальное масштабирование |
| **UX** | Минималистичный | Простой | Гибкий | Иммерсивный | Быстрый | Telegram-подобный + лаконичность TikTok |
| **Сторис** | ❌ | ✅ | ✅ | ✅ Основная фича | ✅ | ✅ Вертикальный скролл |
| **Видео/звонки** | ✅ | ✅ | ✅ | ✅ | ❌ | ✅ P2P + SFU для групп |
| **Ленты/микроблоги** | ❌ | ❌ | ✅ Каналы | ✅ | ✅ Основная фича | ✅ Мини-блоги (X-подобные) |
| **Боты/плагины** | ❌ | ❌ | ✅ | ❌ | ✅ | ✅ Планируется |
| **Модерация** | Базовая | Базовая | Средняя | Высокая | Высокая | AI-Guardian (автоматическая) |
| **Антиспам** | Базовая | Средняя | Средняя | Высокая | Высокая | Поведенческий анализ + AI |
| **Монетизация** | Подписки | ❌ | Premium | Реклама | Реклама + Premium | Premium AI, облако, стикеры |

### Что берём и улучшаем

1. **E2EE (Signal Protocol)**
   - ✅ X3DH для установки сессии
   - ✅ Double Ratchet для обновления ключей
   - ✅ Sender Keys для групп
   - ➕ Quantum Sync (CRDT для офлайн-редакций)

2. **UX (Telegram + TikTok)**
   - ✅ Гибкость Telegram
   - ✅ Лаконичность TikTok
   - ➕ Smart Threading (эмбеддинги для контекста)

3. **AI (Ask AI-подобный)**
   - ✅ Контекстные ответы
   - ✅ Работа с файлами
   - ➕ AI-Guardian (безопасность)
   - ➕ On-device режим (приватность)

---

## 2. Архитектура клиента (Android)

### Структура модулей

```
app/
├── src/main/java/com/kent/app/
│   ├── KentApplication.kt
│   ├── MainActivity.kt
│   └── navigation/
│       └── KentNavigation.kt
│
core/
├── ui/              # Theme, компоненты UI
├── network/         # Retrofit, API клиенты
├── crypto/          # E2EE, Android Keystore
├── database/        # Room, SQLCipher
└── common/          # Утилиты, расширения
│
feature/
├── auth/            # Регистрация, OTP
├── chat/            # Чаты, сообщения
├── calls/           # WebRTC, звонки
├── stories/         # Сторис
├── ai/              # Kent.AI ассистент
├── settings/        # Настройки
└── profile/         # Профиль
```

### Технологический стек

- **Kotlin** 1.9.22, JVM Target 17
- **Jetpack Compose** (Material 3, Azure палитра)
- **Hilt** для DI
- **Coroutines/Flow** для асинхронности
- **Room** + **SQLCipher** для локальной БД
- **Retrofit** + **Kotlinx Serialization** для API
- **Coil** для изображений
- **WebRTC** для звонков
- **WorkManager** для фоновых задач
- **FCM** для push-уведомлений

---

## 3. Архитектура сервера

### Микросервисы

```
api-gateway/         # TLS termination, rate limiting, routing
auth/                # OTP, JWT, сессии
users/               # Профили, устройства
messaging/           # Сообщения, чаты
media/               # Загрузка/скачивание медиа (MinIO)
presence/            # Онлайн статус
calls-sfu/           # SFU для групповых звонков (mediasoup/Janus)
ai/                  # AI-ассистент, перевод, суммаризация
moderation/          # AI-Guardian, антиспам
notifications/       # FCM, push
billing/             # Подписки, платежи
admin/               # Админ-панель
```

### Технологии

- **Go 1.21+** (или Rust)
- **PostgreSQL** — основная БД
- **Redis** — кэш, сессии, очереди
- **MinIO** — объектное хранилище
- **NATS/Kafka** — очереди событий
- **gRPC/WebSocket** — real-time коммуникация
- **Kubernetes** — оркестрация

---

## 4. Безопасность

### E2EE (Signal Protocol)

1. **X3DH** — установка сессии
2. **Double Ratchet** — обновление ключей
3. **Sender Keys** — группы
4. **Хранение ключей** — Android Keystore (опционально биометрия)

### Сетевая безопасность

- **TLS 1.3** — все соединения
- **Certificate Pinning** — на клиенте
- **mTLS** — внутри кластера
- **Play Integrity API** — защита от модификаций

---

## 5. AI-возможности

### Kent.AI (главный экран)

- Контекстные ответы
- Работа с файлами
- Перевод в реальном времени
- Смарт-ответы
- Расшифровка голосовых
- Суммаризация чатов

### AI-Guardian

- Детект фишинга
- Токсичность
- Подозрительные активности
- Локальная фильтрация (on-device)

---

## 6. Роадмап

### Фаза 0: Discovery (2 недели)
- Архитектура, дизайн, выбор технологий

### Фаза 1: MVP (8-12 недель)
- Регистрация (SMS/voice OTP)
- Чаты 1:1
- E2EE базовая
- Kent.AI базовая

### Фаза 2: Звонки (4-6 недель)
- 1:1 P2P
- Группы SFU
- WebRTC оптимизация

### Фаза 3: AI и сторис (6-8 недель)
- AI-Guardian
- Сторис
- Мини-блоги

### Фаза 4: Масштаб и монетизация (ongoing)
- Оптимизация
- Premium функции
- Монетизация

